{"version":3,"file":"index.js","names":["mongoose","require","test","version","Promise","connect","jest","fn","mockImplementation","resolve","createConnection","mockReturnValue","catch","model","bind","on","once","then","ops","mockedReturn","cb","op","modelName","_mongooseOptions","Model","mock","mockingoose","__mocks","err","Error","includes","Array","isArray","map","item","doc","e","validateSync","lean","rawResult","toObject","forEach","Query","prototype","criteria","options","callback","merge","setUpdate","arguments","length","undefined","exec","call","Aggregate","_model","aggregate","insertMany","arr","Object","assign","instance","methodName","constructor","hooks","reject","execPre","ret","execPost","err2","ret2","err3","doMock","proxyTarget","resetAll","toJSON","getMockController","prop","toReturn","o","hasOwnProperty","reset","proxyTraps","get","target","Reflect","apply","thisArg","mockModel","Proxy","module","exports"],"sources":["../src/index.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nif (!/^5/.test(mongoose.version)) {\n  mongoose.Promise = Promise;\n}\n\nmongoose.connect = jest\n  .fn()\n  .mockImplementation(() => Promise.resolve());\n\nmongoose.createConnection = jest.fn().mockReturnValue({\n  catch() {\n    /* no op */\n  },\n  model: mongoose.model.bind(mongoose),\n  on: jest.fn(),\n  once: jest.fn(),\n  then(resolve) {\n    return Promise.resolve(resolve(this));\n  },\n});\n\nconst ops = [\n  'find',\n  'findOne',\n  'count',\n  'countDocuments',\n  'estimatedDocumentCount',\n  'distinct',\n  'findOneAndUpdate',\n  'findOneAndDelete',\n  'findOneAndRemove',\n  'findOneAndReplace',\n  'remove',\n  'update',\n  'updateOne',\n  'updateMany',\n  'deleteOne',\n  'deleteMany',\n  'save',\n  'aggregate',\n  '$save',\n];\n\nconst mockedReturn = async function(cb) {\n  const {\n    op,\n    model: { modelName },\n    _mongooseOptions = {},\n  } = this;\n  const Model = mongoose.model(modelName);\n\n  let mock =\n    mockingoose.__mocks[modelName] && mockingoose.__mocks[modelName][op];\n\n  let err = null;\n\n  if (mock instanceof Error) {\n    err = mock;\n  }\n\n  if (typeof mock === 'function') {\n    mock = await mock(this);\n  }\n\n  if (!mock && op === 'save') {\n    mock = this;\n  }\n\n  if (!mock && op === '$save') {\n    mock = this;\n  }\n\n  if (\n    mock &&\n    !(mock instanceof Model) &&\n    ![\n      'remove',\n      'deleteOne',\n      'deleteMany',\n      'update',\n      'updateOne',\n      'updateMany',\n      'count',\n      'countDocuments',\n      'estimatedDocumentCount',\n      'distinct',\n    ].includes(op)\n  ) {\n    mock = Array.isArray(mock)\n      ? mock.map(item => new Model(item))\n      : new Model(mock);\n\n    if(op === 'insertMany') {\n      if(!Array.isArray(mock)) mock = [mock];\n\n      for(const doc of mock) {\n        const e = doc.validateSync();\n        if(e) throw e;\n      }\n    }\n\n    if (_mongooseOptions.lean || _mongooseOptions.rawResult) {\n      mock = Array.isArray(mock)\n        ? mock.map(item => item.toObject())\n        : mock.toObject();\n    }\n  }\n\n  if (cb) {\n    return cb(err, mock);\n  }\n\n  if (err) {\n    throw err;\n  }\n\n  return mock;\n};\n\nops.forEach(op => {\n  mongoose.Query.prototype[op] = jest\n    .fn()\n    .mockImplementation(function(criteria, doc, options, callback) {\n      if (\n        [\n          'find',\n          'findOne',\n          'count',\n          'countDocuments',\n          'remove',\n          'deleteOne',\n          'deleteMany',\n          'update',\n          'updateOne',\n          'updateMany',\n          'findOneAndUpdate',\n          'findOneAndRemove',\n          'findOneAndDelete',\n          'findOneAndReplace',\n        ].includes(op) &&\n        typeof criteria !== 'function'\n      ) {\n        // find and findOne can take conditions as the first paramter\n        // ensure they make it into the Query conditions\n        this.merge(criteria);\n      }\n\n      if (['distinct'].includes(op) && typeof doc !== 'function') {\n        // distinct has the conditions as the second parameter\n        this.merge(doc);\n      }\n\n      if (/update/i.test(op) && typeof doc !== 'function' && doc) {\n        this.setUpdate(doc);\n      }\n\n      switch (arguments.length) {\n        case 4:\n        case 3:\n          if (typeof options === 'function') {\n            callback = options;\n            options = {};\n          }\n          break;\n        case 2:\n          if (typeof doc === 'function') {\n            callback = doc;\n            doc = criteria;\n            criteria = undefined;\n          }\n          options = undefined;\n          break;\n        case 1:\n          if (typeof criteria === 'function') {\n            callback = criteria;\n            criteria = options = doc = undefined;\n          } else {\n            doc = criteria;\n            criteria = options = undefined;\n          }\n      }\n\n      this.op = op;\n\n      if (!callback) {\n        return this;\n      }\n\n      return this.exec.call(this, callback);\n    });\n});\n\nmongoose.Query.prototype.exec = jest.fn().mockImplementation(function(cb) {\n  return mockedReturn.call(this, cb);\n});\n\nmongoose.Aggregate.prototype.exec = jest\n  .fn()\n  .mockImplementation(async function(cb) {\n    const {\n      _model: { modelName },\n    } = this;\n\n    let mock =\n      mockingoose.__mocks[modelName] &&\n      mockingoose.__mocks[modelName].aggregate;\n\n    let err = null;\n\n    if (mock instanceof Error) {\n      err = mock;\n    }\n\n    if (typeof mock === 'function') {\n      mock = await mock(this);\n    }\n\n    if (cb) {\n      return cb(err, mock);\n    }\n\n    if (err) {\n      throw err;\n    }\n\n    return mock;\n  });\n\nmongoose.Model.insertMany = jest\n  .fn()\n  .mockImplementation(function(arr, options, cb) {\n    const op = 'insertMany';\n    const { modelName } = this;\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = null;\n    } else {\n      this._mongooseOptions = options;\n    }\n\n    Object.assign(this, { op, model: { modelName }})\n    return mockedReturn.call(this, cb);\n  })\n\nconst instance = ['remove', 'save', '$save'];\n\ninstance.forEach(methodName => {\n  mongoose.Model.prototype[methodName] = jest\n    .fn()\n    .mockImplementation(function(options, cb) {\n      const op = methodName;\n      const { modelName } = this.constructor;\n\n      if (typeof options === 'function') {\n        cb = options;\n      }\n\n      Object.assign(this, { op, model: { modelName } });\n\n      const hooks = this.constructor.hooks;\n\n      return new Promise((resolve, reject) => {\n        hooks.execPre(op, this, [cb], err => {\n          if (err) {\n            reject(err);\n            return;\n          }\n\n          const ret = mockedReturn.call(this, cb);\n\n          if (cb) {\n            hooks.execPost(op, this, [ret], err2 => {\n              if (err2) {\n                reject(err2);\n                return;\n              }\n\n              resolve(ret);\n            });\n          } else {\n            ret\n              .then(ret2 => {\n                hooks.execPost(op, this, [ret2], err3 => {\n                  if (err3) {\n                    reject(err3);\n                    return;\n                  }\n\n                  resolve(ret2);\n                });\n              })\n              .catch(reject);\n          }\n        });\n      });\n    });\n});\n\njest.doMock('mongoose', () => mongoose);\n\n// extend a plain function, we will override it with the Proxy later\nconst proxyTarget = Object.assign(() => void 0, {\n  __mocks: {},\n  resetAll() {\n    this.__mocks = {};\n  },\n  toJSON() {\n    return this.__mocks;\n  },\n});\n\nconst getMockController = prop => {\n  return {\n    toReturn(o, op = 'find') {\n      proxyTarget.__mocks.hasOwnProperty(prop)\n        ? (proxyTarget.__mocks[prop][op] = o)\n        : (proxyTarget.__mocks[prop] = { [op]: o });\n\n      return this;\n    },\n\n    reset(op) {\n      if (op) {\n        delete proxyTarget.__mocks[prop][op];\n      } else {\n        delete proxyTarget.__mocks[prop];\n      }\n\n      return this;\n    },\n\n    toJSON() {\n      return proxyTarget.__mocks[prop] || {};\n    },\n  };\n};\n\nconst proxyTraps = {\n  get(target, prop) {\n    if (target.hasOwnProperty(prop)) {\n      return Reflect.get(target, prop);\n    }\n\n    return getMockController(prop);\n  },\n  apply: (target, thisArg, [prop]) => mockModel(prop),\n};\n\nconst mockingoose = new Proxy(proxyTarget, proxyTraps);\n\n/**\n * Returns a helper with which you can set up mocks for a particular Model\n */\nconst mockModel = (model) => {\n  const modelName = typeof model === 'function' ? model.modelName : model;\n  if (typeof modelName === 'string') {\n    return getMockController(modelName);\n  } else {\n    throw new Error('model must be a string or mongoose.Model');\n  }\n};\n\nmodule.exports = mockingoose;\n"],"mappings":"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"}