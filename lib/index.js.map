{"version":3,"file":"index.js","names":["mongoose","require","test","version","Promise","connect","jest","fn","mockImplementation","resolve","createConnection","mockReturnValue","catch","model","bind","on","once","then","ops","mockedReturn","cb","op","modelName","_mongooseOptions","Model","mock","mockingoose","__mocks","err","Error","includes","Array","isArray","map","item","doc","e","validateSync","lean","rawResult","toObject","forEach","Query","prototype","criteria","options","callback","merge","setUpdate","arguments","length","undefined","exec","call","orFail","hasAnyDocs","isErrorFn","Aggregate","_model","aggregate","insertMany","arr","Object","assign","instance","methodName","constructor","hooks","reject","execPre","ret","execPost","err2","ret2","err3","doMock","proxyTarget","resetAll","toJSON","getMockController","prop","toReturn","o","hasOwnProperty","reset","proxyTraps","get","target","Reflect","apply","thisArg","mockModel","Proxy","module","exports"],"sources":["../src/index.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nif (!/^5/.test(mongoose.version)) {\n  mongoose.Promise = Promise;\n}\n\nmongoose.connect = jest.fn().mockImplementation(() => Promise.resolve());\n\nmongoose.createConnection = jest.fn().mockReturnValue({\n  catch() {\n    /* no op */\n  },\n  model: mongoose.model.bind(mongoose),\n  on: jest.fn(),\n  once: jest.fn(),\n  then(resolve) {\n    return Promise.resolve(resolve(this));\n  },\n});\n\nconst ops = [\n  'find',\n  'findOne',\n  'count',\n  'countDocuments',\n  'estimatedDocumentCount',\n  'distinct',\n  'findOneAndUpdate',\n  'findOneAndDelete',\n  'findOneAndRemove',\n  'findOneAndReplace',\n  'remove',\n  'update',\n  'updateOne',\n  'updateMany',\n  'deleteOne',\n  'deleteMany',\n  'save',\n  'aggregate',\n  '$save',\n];\n\nconst mockedReturn = async function (cb) {\n  const {\n    op,\n    model: { modelName },\n    _mongooseOptions = {},\n  } = this;\n  const Model = mongoose.model(modelName);\n\n  let mock =\n    mockingoose.__mocks[modelName] && mockingoose.__mocks[modelName][op];\n\n  let err = null;\n\n  if (mock instanceof Error) {\n    err = mock;\n  }\n\n  if (typeof mock === 'function') {\n    mock = await mock(this);\n  }\n\n  if (!mock && op === 'save') {\n    mock = this;\n  }\n\n  if (!mock && op === '$save') {\n    mock = this;\n  }\n\n  if (\n    mock &&\n    !(mock instanceof Model) &&\n    ![\n      'remove',\n      'deleteOne',\n      'deleteMany',\n      'update',\n      'updateOne',\n      'updateMany',\n      'count',\n      'countDocuments',\n      'estimatedDocumentCount',\n      'distinct',\n    ].includes(op)\n  ) {\n    mock = Array.isArray(mock)\n      ? mock.map((item) => new Model(item))\n      : new Model(mock);\n\n    if (op === 'insertMany') {\n      if (!Array.isArray(mock)) mock = [mock];\n\n      for (const doc of mock) {\n        const e = doc.validateSync();\n        if (e) throw e;\n      }\n    }\n\n    if (_mongooseOptions.lean || _mongooseOptions.rawResult) {\n      mock = Array.isArray(mock)\n        ? mock.map((item) => item.toObject())\n        : mock.toObject();\n    }\n  }\n\n  if (cb) {\n    return cb(err, mock);\n  }\n\n  if (err) {\n    throw err;\n  }\n\n  return mock;\n};\n\nops.forEach((op) => {\n  mongoose.Query.prototype[op] = jest\n    .fn()\n    .mockImplementation(function (criteria, doc, options, callback) {\n      if (\n        [\n          'find',\n          'findOne',\n          'count',\n          'countDocuments',\n          'remove',\n          'deleteOne',\n          'deleteMany',\n          'update',\n          'updateOne',\n          'updateMany',\n          'findOneAndUpdate',\n          'findOneAndRemove',\n          'findOneAndDelete',\n          'findOneAndReplace',\n        ].includes(op) &&\n        typeof criteria !== 'function'\n      ) {\n        // find and findOne can take conditions as the first paramter\n        // ensure they make it into the Query conditions\n        this.merge(criteria);\n      }\n\n      if (['distinct'].includes(op) && typeof doc !== 'function') {\n        // distinct has the conditions as the second parameter\n        this.merge(doc);\n      }\n\n      if (/update/i.test(op) && typeof doc !== 'function' && doc) {\n        this.setUpdate(doc);\n      }\n\n      switch (arguments.length) {\n        case 4:\n        case 3:\n          if (typeof options === 'function') {\n            callback = options;\n            options = {};\n          }\n          break;\n        case 2:\n          if (typeof doc === 'function') {\n            callback = doc;\n            doc = criteria;\n            criteria = undefined;\n          }\n          options = undefined;\n          break;\n        case 1:\n          if (typeof criteria === 'function') {\n            callback = criteria;\n            criteria = options = doc = undefined;\n          } else {\n            doc = criteria;\n            criteria = options = undefined;\n          }\n      }\n\n      this.op = op;\n\n      if (!callback) {\n        return this;\n      }\n\n      return this.exec.call(this, callback);\n    });\n});\n\nmongoose.Query.prototype.exec = jest.fn().mockImplementation(function (cb) {\n  return mockedReturn.call(this, cb);\n});\n\nmongoose.Query.prototype.orFail = jest\n  .fn()\n  .mockImplementation(async function (err) {\n    return this.then((doc) => {\n      const hasAnyDocs = doc && Array.isArray(doc) && doc.length > 0;\n\n      if (!doc || !hasAnyDocs) {\n        if (!err) throw new Error();\n\n        const isErrorFn = typeof err === 'function';\n        throw isErrorFn ? err() : new Error(err);\n      }\n\n      return this;\n    }).catch((err) => {\n      throw err;\n    });\n  });\n\nmongoose.Aggregate.prototype.exec = jest\n  .fn()\n  .mockImplementation(async function (cb) {\n    const {\n      _model: { modelName },\n    } = this;\n\n    let mock =\n      mockingoose.__mocks[modelName] &&\n      mockingoose.__mocks[modelName].aggregate;\n\n    let err = null;\n\n    if (mock instanceof Error) {\n      err = mock;\n    }\n\n    if (typeof mock === 'function') {\n      mock = await mock(this);\n    }\n\n    if (cb) {\n      return cb(err, mock);\n    }\n\n    if (err) {\n      throw err;\n    }\n\n    return mock;\n  });\n\nmongoose.Model.insertMany = jest\n  .fn()\n  .mockImplementation(function (arr, options, cb) {\n    const op = 'insertMany';\n    const { modelName } = this;\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = null;\n    } else {\n      this._mongooseOptions = options;\n    }\n\n    Object.assign(this, { op, model: { modelName } });\n    return mockedReturn.call(this, cb);\n  });\n\nconst instance = ['remove', 'save', '$save'];\n\ninstance.forEach((methodName) => {\n  mongoose.Model.prototype[methodName] = jest\n    .fn()\n    .mockImplementation(function (options, cb) {\n      const op = methodName;\n      const { modelName } = this.constructor;\n\n      if (typeof options === 'function') {\n        cb = options;\n      }\n\n      Object.assign(this, { op, model: { modelName } });\n\n      const hooks = this.constructor.hooks;\n\n      return new Promise((resolve, reject) => {\n        hooks.execPre(op, this, [cb], (err) => {\n          if (err) {\n            reject(err);\n            return;\n          }\n\n          const ret = mockedReturn.call(this, cb);\n\n          if (cb) {\n            hooks.execPost(op, this, [ret], (err2) => {\n              if (err2) {\n                reject(err2);\n                return;\n              }\n\n              resolve(ret);\n            });\n          } else {\n            ret\n              .then((ret2) => {\n                hooks.execPost(op, this, [ret2], (err3) => {\n                  if (err3) {\n                    reject(err3);\n                    return;\n                  }\n\n                  resolve(ret2);\n                });\n              })\n              .catch(reject);\n          }\n        });\n      });\n    });\n});\n\njest.doMock('mongoose', () => mongoose);\n\n// extend a plain function, we will override it with the Proxy later\nconst proxyTarget = Object.assign(() => void 0, {\n  __mocks: {},\n  resetAll() {\n    this.__mocks = {};\n  },\n  toJSON() {\n    return this.__mocks;\n  },\n});\n\nconst getMockController = (prop) => {\n  return {\n    toReturn(o, op = 'find') {\n      proxyTarget.__mocks.hasOwnProperty(prop)\n        ? (proxyTarget.__mocks[prop][op] = o)\n        : (proxyTarget.__mocks[prop] = { [op]: o });\n\n      return this;\n    },\n\n    reset(op) {\n      if (op) {\n        delete proxyTarget.__mocks[prop][op];\n      } else {\n        delete proxyTarget.__mocks[prop];\n      }\n\n      return this;\n    },\n\n    toJSON() {\n      return proxyTarget.__mocks[prop] || {};\n    },\n  };\n};\n\nconst proxyTraps = {\n  get(target, prop) {\n    if (target.hasOwnProperty(prop)) {\n      return Reflect.get(target, prop);\n    }\n\n    return getMockController(prop);\n  },\n  apply: (target, thisArg, [prop]) => mockModel(prop),\n};\n\nconst mockingoose = new Proxy(proxyTarget, proxyTraps);\n\n/**\n * Returns a helper with which you can set up mocks for a particular Model\n */\nconst mockModel = (model) => {\n  const modelName = typeof model === 'function' ? model.modelName : model;\n  if (typeof modelName === 'string') {\n    return getMockController(modelName);\n  } else {\n    throw new Error('model must be a string or mongoose.Model');\n  }\n};\n\nmodule.exports = mockingoose;\n"],"mappings":";;;;;;;AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,IAAI,CAAC,IAAI,CAACC,IAAI,CAACF,QAAQ,CAACG,OAAO,CAAC,EAAE;EAChCH,QAAQ,CAACI,OAAO,GAAGA,OAAO;AAC5B;AAEAJ,QAAQ,CAACK,OAAO,GAAGC,IAAI,CAACC,EAAE,EAAE,CAACC,kBAAkB,CAAC,MAAMJ,OAAO,CAACK,OAAO,EAAE,CAAC;AAExET,QAAQ,CAACU,gBAAgB,GAAGJ,IAAI,CAACC,EAAE,EAAE,CAACI,eAAe,CAAC;EACpDC,KAAK,GAAG;IACN;EAAA,CACD;EACDC,KAAK,EAAEb,QAAQ,CAACa,KAAK,CAACC,IAAI,CAACd,QAAQ,CAAC;EACpCe,EAAE,EAAET,IAAI,CAACC,EAAE,EAAE;EACbS,IAAI,EAAEV,IAAI,CAACC,EAAE,EAAE;EACfU,IAAI,CAACR,OAAO,EAAE;IACZ,OAAOL,OAAO,CAACK,OAAO,CAACA,OAAO,CAAC,IAAI,CAAC,CAAC;EACvC;AACF,CAAC,CAAC;AAEF,MAAMS,GAAG,GAAG,CACV,MAAM,EACN,SAAS,EACT,OAAO,EACP,gBAAgB,EAChB,wBAAwB,EACxB,UAAU,EACV,kBAAkB,EAClB,kBAAkB,EAClB,kBAAkB,EAClB,mBAAmB,EACnB,QAAQ,EACR,QAAQ,EACR,WAAW,EACX,YAAY,EACZ,WAAW,EACX,YAAY,EACZ,MAAM,EACN,WAAW,EACX,OAAO,CACR;AAED,MAAMC,YAAY;EAAA,6BAAG,WAAgBC,EAAE,EAAE;IACvC,MACEC,EAAE,GAGA,IAAI,CAHNA,EAAE;MACOC,SAAS,GAEhB,IAAI,CAFNT,KAAK,CAAIS,SAAS;MAAA,wBAEhB,IAAI,CADNC,gBAAgB;MAAhBA,gBAAgB,sCAAG,CAAC,CAAC;IAEvB,MAAMC,KAAK,GAAGxB,QAAQ,CAACa,KAAK,CAACS,SAAS,CAAC;IAEvC,IAAIG,IAAI,GACNC,WAAW,CAACC,OAAO,CAACL,SAAS,CAAC,IAAII,WAAW,CAACC,OAAO,CAACL,SAAS,CAAC,CAACD,EAAE,CAAC;IAEtE,IAAIO,GAAG,GAAG,IAAI;IAEd,IAAIH,IAAI,YAAYI,KAAK,EAAE;MACzBD,GAAG,GAAGH,IAAI;IACZ;IAEA,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;MAC9BA,IAAI,SAASA,IAAI,CAAC,IAAI,CAAC;IACzB;IAEA,IAAI,CAACA,IAAI,IAAIJ,EAAE,KAAK,MAAM,EAAE;MAC1BI,IAAI,GAAG,IAAI;IACb;IAEA,IAAI,CAACA,IAAI,IAAIJ,EAAE,KAAK,OAAO,EAAE;MAC3BI,IAAI,GAAG,IAAI;IACb;IAEA,IACEA,IAAI,IACJ,EAAEA,IAAI,YAAYD,KAAK,CAAC,IACxB,CAAC,CACC,QAAQ,EACR,WAAW,EACX,YAAY,EACZ,QAAQ,EACR,WAAW,EACX,YAAY,EACZ,OAAO,EACP,gBAAgB,EAChB,wBAAwB,EACxB,UAAU,CACX,CAACM,QAAQ,CAACT,EAAE,CAAC,EACd;MACAI,IAAI,GAAGM,KAAK,CAACC,OAAO,CAACP,IAAI,CAAC,GACtBA,IAAI,CAACQ,GAAG,CAAEC,IAAI,IAAK,IAAIV,KAAK,CAACU,IAAI,CAAC,CAAC,GACnC,IAAIV,KAAK,CAACC,IAAI,CAAC;MAEnB,IAAIJ,EAAE,KAAK,YAAY,EAAE;QACvB,IAAI,CAACU,KAAK,CAACC,OAAO,CAACP,IAAI,CAAC,EAAEA,IAAI,GAAG,CAACA,IAAI,CAAC;QAAC,2CAEtBA,IAAI;UAAA;QAAA;UAAtB,oDAAwB;YAAA,MAAbU,GAAG;YACZ,MAAMC,CAAC,GAAGD,GAAG,CAACE,YAAY,EAAE;YAC5B,IAAID,CAAC,EAAE,MAAMA,CAAC;UAChB;QAAC;UAAA;QAAA;UAAA;QAAA;MACH;MAEA,IAAIb,gBAAgB,CAACe,IAAI,IAAIf,gBAAgB,CAACgB,SAAS,EAAE;QACvDd,IAAI,GAAGM,KAAK,CAACC,OAAO,CAACP,IAAI,CAAC,GACtBA,IAAI,CAACQ,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACM,QAAQ,EAAE,CAAC,GACnCf,IAAI,CAACe,QAAQ,EAAE;MACrB;IACF;IAEA,IAAIpB,EAAE,EAAE;MACN,OAAOA,EAAE,CAACQ,GAAG,EAAEH,IAAI,CAAC;IACtB;IAEA,IAAIG,GAAG,EAAE;MACP,MAAMA,GAAG;IACX;IAEA,OAAOH,IAAI;EACb,CAAC;EAAA,gBA1EKN,YAAY;IAAA;EAAA;AAAA,GA0EjB;AAEDD,GAAG,CAACuB,OAAO,CAAEpB,EAAE,IAAK;EAClBrB,QAAQ,CAAC0C,KAAK,CAACC,SAAS,CAACtB,EAAE,CAAC,GAAGf,IAAI,CAChCC,EAAE,EAAE,CACJC,kBAAkB,CAAC,UAAUoC,QAAQ,EAAET,GAAG,EAAEU,OAAO,EAAEC,QAAQ,EAAE;IAC9D,IACE,CACE,MAAM,EACN,SAAS,EACT,OAAO,EACP,gBAAgB,EAChB,QAAQ,EACR,WAAW,EACX,YAAY,EACZ,QAAQ,EACR,WAAW,EACX,YAAY,EACZ,kBAAkB,EAClB,kBAAkB,EAClB,kBAAkB,EAClB,mBAAmB,CACpB,CAAChB,QAAQ,CAACT,EAAE,CAAC,IACd,OAAOuB,QAAQ,KAAK,UAAU,EAC9B;MACA;MACA;MACA,IAAI,CAACG,KAAK,CAACH,QAAQ,CAAC;IACtB;IAEA,IAAI,CAAC,UAAU,CAAC,CAACd,QAAQ,CAACT,EAAE,CAAC,IAAI,OAAOc,GAAG,KAAK,UAAU,EAAE;MAC1D;MACA,IAAI,CAACY,KAAK,CAACZ,GAAG,CAAC;IACjB;IAEA,IAAI,SAAS,CAACjC,IAAI,CAACmB,EAAE,CAAC,IAAI,OAAOc,GAAG,KAAK,UAAU,IAAIA,GAAG,EAAE;MAC1D,IAAI,CAACa,SAAS,CAACb,GAAG,CAAC;IACrB;IAEA,QAAQc,SAAS,CAACC,MAAM;MACtB,KAAK,CAAC;MACN,KAAK,CAAC;QACJ,IAAI,OAAOL,OAAO,KAAK,UAAU,EAAE;UACjCC,QAAQ,GAAGD,OAAO;UAClBA,OAAO,GAAG,CAAC,CAAC;QACd;QACA;MACF,KAAK,CAAC;QACJ,IAAI,OAAOV,GAAG,KAAK,UAAU,EAAE;UAC7BW,QAAQ,GAAGX,GAAG;UACdA,GAAG,GAAGS,QAAQ;UACdA,QAAQ,GAAGO,SAAS;QACtB;QACAN,OAAO,GAAGM,SAAS;QACnB;MACF,KAAK,CAAC;QACJ,IAAI,OAAOP,QAAQ,KAAK,UAAU,EAAE;UAClCE,QAAQ,GAAGF,QAAQ;UACnBA,QAAQ,GAAGC,OAAO,GAAGV,GAAG,GAAGgB,SAAS;QACtC,CAAC,MAAM;UACLhB,GAAG,GAAGS,QAAQ;UACdA,QAAQ,GAAGC,OAAO,GAAGM,SAAS;QAChC;IAAC;IAGL,IAAI,CAAC9B,EAAE,GAAGA,EAAE;IAEZ,IAAI,CAACyB,QAAQ,EAAE;MACb,OAAO,IAAI;IACb;IAEA,OAAO,IAAI,CAACM,IAAI,CAACC,IAAI,CAAC,IAAI,EAAEP,QAAQ,CAAC;EACvC,CAAC,CAAC;AACN,CAAC,CAAC;AAEF9C,QAAQ,CAAC0C,KAAK,CAACC,SAAS,CAACS,IAAI,GAAG9C,IAAI,CAACC,EAAE,EAAE,CAACC,kBAAkB,CAAC,UAAUY,EAAE,EAAE;EACzE,OAAOD,YAAY,CAACkC,IAAI,CAAC,IAAI,EAAEjC,EAAE,CAAC;AACpC,CAAC,CAAC;AAEFpB,QAAQ,CAAC0C,KAAK,CAACC,SAAS,CAACW,MAAM,GAAGhD,IAAI,CACnCC,EAAE,EAAE,CACJC,kBAAkB;EAAA,8BAAC,WAAgBoB,GAAG,EAAE;IACvC,OAAO,IAAI,CAACX,IAAI,CAAEkB,GAAG,IAAK;MACxB,MAAMoB,UAAU,GAAGpB,GAAG,IAAIJ,KAAK,CAACC,OAAO,CAACG,GAAG,CAAC,IAAIA,GAAG,CAACe,MAAM,GAAG,CAAC;MAE9D,IAAI,CAACf,GAAG,IAAI,CAACoB,UAAU,EAAE;QACvB,IAAI,CAAC3B,GAAG,EAAE,MAAM,IAAIC,KAAK,EAAE;QAE3B,MAAM2B,SAAS,GAAG,OAAO5B,GAAG,KAAK,UAAU;QAC3C,MAAM4B,SAAS,GAAG5B,GAAG,EAAE,GAAG,IAAIC,KAAK,CAACD,GAAG,CAAC;MAC1C;MAEA,OAAO,IAAI;IACb,CAAC,CAAC,CAAChB,KAAK,CAAEgB,GAAG,IAAK;MAChB,MAAMA,GAAG;IACX,CAAC,CAAC;EACJ,CAAC;EAAA;IAAA;EAAA;AAAA,IAAC;AAEJ5B,QAAQ,CAACyD,SAAS,CAACd,SAAS,CAACS,IAAI,GAAG9C,IAAI,CACrCC,EAAE,EAAE,CACJC,kBAAkB;EAAA,8BAAC,WAAgBY,EAAE,EAAE;IACtC,MACYE,SAAS,GACjB,IAAI,CADNoC,MAAM,CAAIpC,SAAS;IAGrB,IAAIG,IAAI,GACNC,WAAW,CAACC,OAAO,CAACL,SAAS,CAAC,IAC9BI,WAAW,CAACC,OAAO,CAACL,SAAS,CAAC,CAACqC,SAAS;IAE1C,IAAI/B,GAAG,GAAG,IAAI;IAEd,IAAIH,IAAI,YAAYI,KAAK,EAAE;MACzBD,GAAG,GAAGH,IAAI;IACZ;IAEA,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;MAC9BA,IAAI,SAASA,IAAI,CAAC,IAAI,CAAC;IACzB;IAEA,IAAIL,EAAE,EAAE;MACN,OAAOA,EAAE,CAACQ,GAAG,EAAEH,IAAI,CAAC;IACtB;IAEA,IAAIG,GAAG,EAAE;MACP,MAAMA,GAAG;IACX;IAEA,OAAOH,IAAI;EACb,CAAC;EAAA;IAAA;EAAA;AAAA,IAAC;AAEJzB,QAAQ,CAACwB,KAAK,CAACoC,UAAU,GAAGtD,IAAI,CAC7BC,EAAE,EAAE,CACJC,kBAAkB,CAAC,UAAUqD,GAAG,EAAEhB,OAAO,EAAEzB,EAAE,EAAE;EAC9C,MAAMC,EAAE,GAAG,YAAY;EACvB,MAAQC,SAAS,GAAK,IAAI,CAAlBA,SAAS;EAEjB,IAAI,OAAOuB,OAAO,KAAK,UAAU,EAAE;IACjCzB,EAAE,GAAGyB,OAAO;IACZA,OAAO,GAAG,IAAI;EAChB,CAAC,MAAM;IACL,IAAI,CAACtB,gBAAgB,GAAGsB,OAAO;EACjC;EAEAiB,MAAM,CAACC,MAAM,CAAC,IAAI,EAAE;IAAE1C,EAAE;IAAER,KAAK,EAAE;MAAES;IAAU;EAAE,CAAC,CAAC;EACjD,OAAOH,YAAY,CAACkC,IAAI,CAAC,IAAI,EAAEjC,EAAE,CAAC;AACpC,CAAC,CAAC;AAEJ,MAAM4C,QAAQ,GAAG,CAAC,QAAQ,EAAE,MAAM,EAAE,OAAO,CAAC;AAE5CA,QAAQ,CAACvB,OAAO,CAAEwB,UAAU,IAAK;EAC/BjE,QAAQ,CAACwB,KAAK,CAACmB,SAAS,CAACsB,UAAU,CAAC,GAAG3D,IAAI,CACxCC,EAAE,EAAE,CACJC,kBAAkB,CAAC,UAAUqC,OAAO,EAAEzB,EAAE,EAAE;IACzC,MAAMC,EAAE,GAAG4C,UAAU;IACrB,MAAQ3C,SAAS,GAAK,IAAI,CAAC4C,WAAW,CAA9B5C,SAAS;IAEjB,IAAI,OAAOuB,OAAO,KAAK,UAAU,EAAE;MACjCzB,EAAE,GAAGyB,OAAO;IACd;IAEAiB,MAAM,CAACC,MAAM,CAAC,IAAI,EAAE;MAAE1C,EAAE;MAAER,KAAK,EAAE;QAAES;MAAU;IAAE,CAAC,CAAC;IAEjD,MAAM6C,KAAK,GAAG,IAAI,CAACD,WAAW,CAACC,KAAK;IAEpC,OAAO,IAAI/D,OAAO,CAAC,CAACK,OAAO,EAAE2D,MAAM,KAAK;MACtCD,KAAK,CAACE,OAAO,CAAChD,EAAE,EAAE,IAAI,EAAE,CAACD,EAAE,CAAC,EAAGQ,GAAG,IAAK;QACrC,IAAIA,GAAG,EAAE;UACPwC,MAAM,CAACxC,GAAG,CAAC;UACX;QACF;QAEA,MAAM0C,GAAG,GAAGnD,YAAY,CAACkC,IAAI,CAAC,IAAI,EAAEjC,EAAE,CAAC;QAEvC,IAAIA,EAAE,EAAE;UACN+C,KAAK,CAACI,QAAQ,CAAClD,EAAE,EAAE,IAAI,EAAE,CAACiD,GAAG,CAAC,EAAGE,IAAI,IAAK;YACxC,IAAIA,IAAI,EAAE;cACRJ,MAAM,CAACI,IAAI,CAAC;cACZ;YACF;YAEA/D,OAAO,CAAC6D,GAAG,CAAC;UACd,CAAC,CAAC;QACJ,CAAC,MAAM;UACLA,GAAG,CACArD,IAAI,CAAEwD,IAAI,IAAK;YACdN,KAAK,CAACI,QAAQ,CAAClD,EAAE,EAAE,IAAI,EAAE,CAACoD,IAAI,CAAC,EAAGC,IAAI,IAAK;cACzC,IAAIA,IAAI,EAAE;gBACRN,MAAM,CAACM,IAAI,CAAC;gBACZ;cACF;cAEAjE,OAAO,CAACgE,IAAI,CAAC;YACf,CAAC,CAAC;UACJ,CAAC,CAAC,CACD7D,KAAK,CAACwD,MAAM,CAAC;QAClB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;AACN,CAAC,CAAC;AAEF9D,IAAI,CAACqE,MAAM,CAAC,UAAU,EAAE,MAAM3E,QAAQ,CAAC;;AAEvC;AACA,MAAM4E,WAAW,GAAGd,MAAM,CAACC,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE;EAC9CpC,OAAO,EAAE,CAAC,CAAC;EACXkD,QAAQ,GAAG;IACT,IAAI,CAAClD,OAAO,GAAG,CAAC,CAAC;EACnB,CAAC;EACDmD,MAAM,GAAG;IACP,OAAO,IAAI,CAACnD,OAAO;EACrB;AACF,CAAC,CAAC;AAEF,MAAMoD,iBAAiB,GAAIC,IAAI,IAAK;EAClC,OAAO;IACLC,QAAQ,CAACC,CAAC,EAAE7D,EAAE,GAAG,MAAM,EAAE;MACvBuD,WAAW,CAACjD,OAAO,CAACwD,cAAc,CAACH,IAAI,CAAC,GACnCJ,WAAW,CAACjD,OAAO,CAACqD,IAAI,CAAC,CAAC3D,EAAE,CAAC,GAAG6D,CAAC,GACjCN,WAAW,CAACjD,OAAO,CAACqD,IAAI,CAAC,GAAG;QAAE,CAAC3D,EAAE,GAAG6D;MAAE,CAAE;MAE7C,OAAO,IAAI;IACb,CAAC;IAEDE,KAAK,CAAC/D,EAAE,EAAE;MACR,IAAIA,EAAE,EAAE;QACN,OAAOuD,WAAW,CAACjD,OAAO,CAACqD,IAAI,CAAC,CAAC3D,EAAE,CAAC;MACtC,CAAC,MAAM;QACL,OAAOuD,WAAW,CAACjD,OAAO,CAACqD,IAAI,CAAC;MAClC;MAEA,OAAO,IAAI;IACb,CAAC;IAEDF,MAAM,GAAG;MACP,OAAOF,WAAW,CAACjD,OAAO,CAACqD,IAAI,CAAC,IAAI,CAAC,CAAC;IACxC;EACF,CAAC;AACH,CAAC;AAED,MAAMK,UAAU,GAAG;EACjBC,GAAG,CAACC,MAAM,EAAEP,IAAI,EAAE;IAChB,IAAIO,MAAM,CAACJ,cAAc,CAACH,IAAI,CAAC,EAAE;MAC/B,OAAOQ,OAAO,CAACF,GAAG,CAACC,MAAM,EAAEP,IAAI,CAAC;IAClC;IAEA,OAAOD,iBAAiB,CAACC,IAAI,CAAC;EAChC,CAAC;EACDS,KAAK,EAAE,CAACF,MAAM,EAAEG,OAAO,EAAE,CAACV,IAAI,CAAC,KAAKW,SAAS,CAACX,IAAI;AACpD,CAAC;AAED,MAAMtD,WAAW,GAAG,IAAIkE,KAAK,CAAChB,WAAW,EAAES,UAAU,CAAC;;AAEtD;AACA;AACA;AACA,MAAMM,SAAS,GAAI9E,KAAK,IAAK;EAC3B,MAAMS,SAAS,GAAG,OAAOT,KAAK,KAAK,UAAU,GAAGA,KAAK,CAACS,SAAS,GAAGT,KAAK;EACvE,IAAI,OAAOS,SAAS,KAAK,QAAQ,EAAE;IACjC,OAAOyD,iBAAiB,CAACzD,SAAS,CAAC;EACrC,CAAC,MAAM;IACL,MAAM,IAAIO,KAAK,CAAC,0CAA0C,CAAC;EAC7D;AACF,CAAC;AAEDgE,MAAM,CAACC,OAAO,GAAGpE,WAAW"}