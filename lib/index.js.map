{"version":3,"file":"index.js","names":["mongoose","require","test","version","Promise","connect","jest","fn","mockImplementation","resolve","createConnection","mockReturnValue","catch","model","bind","on","once","then","ops","mockedReturn","cb","op","modelName","_model","_mongooseOptions","Model","mock","mockingoose","__mocks","err","Error","includes","Array","isArray","map","item","doc","e","validateSync","lean","rawResult","toObject","forEach","Query","prototype","criteria","options","callback","merge","setUpdate","arguments","length","undefined","exec","call","Aggregate","aggregate","insertMany","arr","Object","assign","instance","methodName","constructor","hooks","reject","execPre","ret","execPost","err2","ret2","err3","doMock","proxyTarget","resetAll","toJSON","getMockController","prop","toReturn","o","hasOwnProperty","reset","proxyTraps","get","target","Reflect","apply","thisArg","mockModel","Proxy","module","exports"],"sources":["../src/index.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nif (!/^5/.test(mongoose.version)) {\n  mongoose.Promise = Promise;\n}\n\nmongoose.connect = jest\n  .fn()\n  .mockImplementation(() => Promise.resolve());\n\nmongoose.createConnection = jest.fn().mockReturnValue({\n  catch() {\n    /* no op */\n  },\n  model: mongoose.model.bind(mongoose),\n  on: jest.fn(),\n  once: jest.fn(),\n  then(resolve) {\n    return Promise.resolve(resolve(this));\n  },\n});\n\nconst ops = [\n  'find',\n  'findOne',\n  'count',\n  'countDocuments',\n  'estimatedDocumentCount',\n  'distinct',\n  'findOneAndUpdate',\n  'findOneAndDelete',\n  'findOneAndRemove',\n  'findOneAndReplace',\n  'remove',\n  'update',\n  'updateOne',\n  'updateMany',\n  'deleteOne',\n  'deleteMany',\n  'save',\n  'aggregate',\n];\n\nconst mockedReturn = async function(cb) {\n  const {\n    op,\n    _model: { modelName },\n    _mongooseOptions = {},\n  } = this;\n  const Model = mongoose.model(modelName);\n\n  let mock =\n    mockingoose.__mocks[modelName] && mockingoose.__mocks[modelName][op];\n\n  let err = null;\n\n  if (mock instanceof Error) {\n    err = mock;\n  }\n\n  if (typeof mock === 'function') {\n    mock = await mock(this);\n  }\n\n  if (!mock && op === 'save') {\n    mock = this;\n  }\n\n  if (\n    mock &&\n    !(mock instanceof Model) &&\n    ![\n      'remove',\n      'deleteOne',\n      'deleteMany',\n      'update',\n      'updateOne',\n      'updateMany',\n      'count',\n      'countDocuments',\n      'estimatedDocumentCount',\n      'distinct',\n    ].includes(op)\n  ) {\n    mock = Array.isArray(mock)\n      ? mock.map(item => new Model(item))\n      : new Model(mock);\n\n    if(op === 'insertMany') {\n      if(!Array.isArray(mock)) mock = [mock];\n\n      for(const doc of mock) {\n        const e = doc.validateSync();\n        if(e) throw e;\n      }\n    }\n\n    if (_mongooseOptions.lean || _mongooseOptions.rawResult) {\n      mock = Array.isArray(mock)\n        ? mock.map(item => item.toObject())\n        : mock.toObject();\n    }\n  }\n\n  if (cb) {\n    return cb(err, mock);\n  }\n\n  if (err) {\n    throw err;\n  }\n\n  return mock;\n};\n\nops.forEach(op => {\n  mongoose.Query.prototype[op] = jest\n    .fn()\n    .mockImplementation(function(criteria, doc, options, callback) {\n      if (\n        [\n          'find',\n          'findOne',\n          'count',\n          'countDocuments',\n          'remove',\n          'deleteOne',\n          'deleteMany',\n          'update',\n          'updateOne',\n          'updateMany',\n          'findOneAndUpdate',\n          'findOneAndRemove',\n          'findOneAndDelete',\n          'findOneAndReplace',\n        ].includes(op) &&\n        typeof criteria !== 'function'\n      ) {\n        // find and findOne can take conditions as the first paramter\n        // ensure they make it into the Query conditions\n        this.merge(criteria);\n      }\n\n      if (['distinct'].includes(op) && typeof doc !== 'function') {\n        // distinct has the conditions as the second parameter\n        this.merge(doc);\n      }\n\n      if (/update/i.test(op) && typeof doc !== 'function' && doc) {\n        this.setUpdate(doc);\n      }\n\n      switch (arguments.length) {\n        case 4:\n        case 3:\n          if (typeof options === 'function') {\n            callback = options;\n            options = {};\n          }\n          break;\n        case 2:\n          if (typeof doc === 'function') {\n            callback = doc;\n            doc = criteria;\n            criteria = undefined;\n          }\n          options = undefined;\n          break;\n        case 1:\n          if (typeof criteria === 'function') {\n            callback = criteria;\n            criteria = options = doc = undefined;\n          } else {\n            doc = criteria;\n            criteria = options = undefined;\n          }\n      }\n\n      this.op = op;\n\n      if (!callback) {\n        return this;\n      }\n\n      return this.exec.call(this, callback);\n    });\n});\n\nmongoose.Query.prototype.exec = jest.fn().mockImplementation(function(cb) {\n  this._model = this.model;\n  delete this.model;\n  return mockedReturn.call(this, cb);\n});\n\nmongoose.Aggregate.prototype.exec = jest\n  .fn()\n  .mockImplementation(async function(cb) {\n    const {\n      _model: { modelName },\n    } = this;\n\n    let mock =\n      mockingoose.__mocks[modelName] &&\n      mockingoose.__mocks[modelName].aggregate;\n\n    let err = null;\n\n    if (mock instanceof Error) {\n      err = mock;\n    }\n\n    if (typeof mock === 'function') {\n      mock = await mock(this);\n    }\n\n    if (cb) {\n      return cb(err, mock);\n    }\n\n    if (err) {\n      throw err;\n    }\n\n    return mock;\n  });\n\nmongoose.Model.insertMany = jest\n  .fn()\n  .mockImplementation(function(arr, options, cb) {\n    const op = 'insertMany';\n    this._model = this.model;\n    delete this.model;\n    const { modelName } = this;\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = null;\n    } else {\n      this._mongooseOptions = options;\n    }\n\n    Object.assign(this, { op, _model: { modelName }});\n    return mockedReturn.call(this, cb);\n  })\n\nconst instance = ['remove', 'save'];\n\ninstance.forEach(methodName => {\n  mongoose.Model.prototype[methodName] = jest\n    .fn()\n    .mockImplementation(function(options, cb) {\n      const op = methodName;\n      this._model = this.model;\n      delete this.model;\n      const { modelName } = this.constructor;\n\n      if (typeof options === 'function') {\n        cb = options;\n      }\n\n      Object.assign(this, { op, _model: { modelName } });\n\n      const hooks = this.constructor.hooks;\n\n      return new Promise((resolve, reject) => {\n        hooks.execPre(op, this, [cb], err => {\n          if (err) {\n            reject(err);\n            return;\n          }\n          const ret = mockedReturn.call(this, cb);\n\n          if (cb) {\n            hooks.execPost(op, this, [ret], err2 => {\n              if (err2) {\n                reject(err2);\n                return;\n              }\n\n              resolve(ret);\n            });\n          } else {\n            ret\n              .then(ret2 => {\n                hooks.execPost(op, this, [ret2], err3 => {\n                  if (err3) {\n                    reject(err3);\n                    return;\n                  }\n\n                  resolve(ret2);\n                });\n              })\n              .catch(reject);\n          }\n        });\n      });\n    });\n});\n\njest.doMock('mongoose', () => mongoose);\n\n// extend a plain function, we will override it with the Proxy later\nconst proxyTarget = Object.assign(() => void 0, {\n  __mocks: {},\n  resetAll() {\n    this.__mocks = {};\n  },\n  toJSON() {\n    return this.__mocks;\n  },\n});\n\nconst getMockController = prop => {\n  return {\n    toReturn(o, op = 'find') {\n      proxyTarget.__mocks.hasOwnProperty(prop)\n        ? (proxyTarget.__mocks[prop][op] = o)\n        : (proxyTarget.__mocks[prop] = { [op]: o });\n\n      return this;\n    },\n\n    reset(op) {\n      if (op) {\n        delete proxyTarget.__mocks[prop][op];\n      } else {\n        delete proxyTarget.__mocks[prop];\n      }\n\n      return this;\n    },\n\n    toJSON() {\n      return proxyTarget.__mocks[prop] || {};\n    },\n  };\n};\n\nconst proxyTraps = {\n  get(target, prop) {\n    if (target.hasOwnProperty(prop)) {\n      return Reflect.get(target, prop);\n    }\n\n    return getMockController(prop);\n  },\n  apply: (target, thisArg, [prop]) => mockModel(prop),\n};\n\nconst mockingoose = new Proxy(proxyTarget, proxyTraps);\n\n/**\n * Returns a helper with which you can set up mocks for a particular Model\n */\nconst mockModel = (model) => {\n  const modelName = typeof model === 'function' ? model.modelName : model;\n  if (typeof modelName === 'string') {\n    return getMockController(modelName);\n  } else {\n    throw new Error('model must be a string or mongoose.Model');\n  }\n};\n\nmodule.exports = mockingoose;\n"],"mappings":"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"}