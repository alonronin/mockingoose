<<<<<<< HEAD
{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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"}
=======
{"version":3,"sources":["../src/index.js"],"names":["test","mongoose","version","Promise","connect","jest","fn","mockImplementation","resolve","createConnection","mockReturnValue","on","once","then","catch","model","bind","ops","mockedReturn","cb","op","modelName","_mongooseOptions","Model","mock","mockingoose","__mocks","err","Error","Function","includes","Array","isArray","map","item","lean","toObject","forEach","Query","prototype","criteria","doc","options","callback","merge","arguments","length","undefined","exec","call","Aggregate","_model","aggregate","instance","methodName","constructor","Object","assign","hooks","reject","execPre","ret","execPost","doMock","target","resetAll","toJSON","traps","get","prop","hasOwnProperty","Reflect","toReturn","o","reset","Proxy"],"mappings":"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","sourcesContent":["import mongoose from 'mongoose';\n\nif(!/^5/.test(mongoose.version)) mongoose.Promise = Promise;\n\nmongoose.connect = jest.fn().mockImplementation(() => Promise.resolve());\nmongoose.createConnection = jest\n  .fn()\n  .mockReturnValue({\n    on: jest.fn(),\n    once: jest.fn(),\n    then(resolve) { return Promise.resolve(resolve(this)); },\n    catch() {},\n    model: mongoose.model.bind(mongoose),\n  });\n\nconst ops = [\n  'find',\n  'findOne',\n  'count',\n  'countDocuments',\n  'estimatedDocumentCount',\n  'distinct',\n  'findOneAndUpdate',\n  'findOneAndDelete',\n  'findOneAndRemove',\n  'findOneAndReplace',\n  'remove',\n  'update',\n  'deleteOne',\n  'deleteMany',\n];\n\nconst mockedReturn = async function (cb) {\n  const { op, model: { modelName }, _mongooseOptions = {} } = this;\n  const Model = mongoose.model(modelName);\n\n  let mock = mockingoose.__mocks[modelName] && mockingoose.__mocks[modelName][op];\n\n  let err = null;\n\n  if (mock instanceof Error) err = mock;\n\n  if (mock instanceof Function) mock = await mock(this);\n\n  if (!mock && op === 'save') { mock = this;}\n\n  if (mock && mock instanceof Model === false && (!['update', 'count', 'countDocuments', 'estimatedDocumentCount', 'distinct'].includes(op))) {\n    mock = Array.isArray(mock) ? mock.map(item => new Model(item)) : new Model(mock);\n\n    if (_mongooseOptions.lean) mock = Array.isArray(mock) ? mock.map(item => item.toObject()) : mock.toObject();\n  }\n\n  if (cb) return cb(err, mock);\n\n  if (err) throw err;\n\n  return mock;\n};\n\nops.forEach(op => {\n  mongoose.Query.prototype[op] = jest.fn().mockImplementation(function (criteria, doc, options, callback) {\n    if ([\n        'find', 'findOne', 'count', 'countDocuments', \n        'remove', 'deleteOne', 'deleteMany', 'findOneAndUpdate',\n        'findOneAndRemove', 'findOneAndDelete', 'findOneAndReplace'\n      ].includes(op) && typeof criteria !== 'function') {\n      // find and findOne can take conditions as the first paramter\n      // ensure they make it into the Query conditions\n      this.merge(criteria);\n    }\n\n    if (['distinct'].includes(op) && typeof doc !== 'function') {\n      // distinct has the conditions as the second parameter\n      this.merge(doc);\n    }\n\n    switch (arguments.length) {\n      case 4:\n      case 3:\n        if (typeof options === 'function') {\n          callback = options;\n          options = {};\n        }\n        break;\n      case 2:\n        if (typeof doc === 'function') {\n          callback = doc;\n          doc = criteria;\n          criteria = undefined;\n        }\n        options = undefined;\n        break;\n      case 1:\n        if (typeof criteria === 'function') {\n          callback = criteria;\n          criteria = options = doc = undefined;\n        } else {\n          doc = criteria;\n          criteria = options = undefined;\n        }\n    }\n\n    this.op = op;\n\n    if (!callback) return this;\n\n    return this.exec.call(this, callback);\n  });\n});\n\nmongoose.Query.prototype.exec = jest.fn().mockImplementation(function cb(cb) {\n  return mockedReturn.call(this, cb);\n});\n\nmongoose.Aggregate.prototype.exec = jest.fn().mockImplementation(async function cb(cb) {\n  const { _model: { modelName } } = this;\n\n  let mock = mockingoose.__mocks[modelName] && mockingoose.__mocks[modelName].aggregate;\n\n  let err = null;\n\n  if (mock instanceof Error) err = mock;\n  \n  if (mock instanceof Function) mock = await mock(this);\n\n  if (cb) return cb(err, mock);\n\n  if (err) throw err;\n\n  return mock;\n});\n\nconst instance = [\n  'remove',\n  'save'\n];\n\ninstance.forEach(methodName => {\n  mongoose.Model.prototype[methodName] = jest.fn().mockImplementation(function (options, cb) {\n    const op = methodName;\n    const { modelName } = this.constructor;\n\n    if (typeof options === 'function') cb = options;\n\n    Object.assign(this, { op, model: { modelName } });\n\n    const hooks = this.constructor.hooks\n\n    return new Promise((resolve, reject) => {\n      hooks.execPre(op, this, [cb], (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n\n        const ret = mockedReturn.call(this, cb);\n\n        if (cb) {\n          hooks.execPost(op, this, [ret], (err) => {\n            if (err) {\n              reject(err);\n              return;\n            }\n\n            resolve(ret);\n          });\n        } else {\n          ret\n            .then((ret) => {\n              hooks.execPost(op, this, [ret], (err) => {\n                if (err) {\n                  reject(err);\n                  return;\n                }\n\n                resolve(ret);\n              });\n            })\n            .catch(reject);\n        }\n      });\n    });\n  });\n});\n\njest.doMock('mongoose', () => mongoose);\n\nconst target = {\n  __mocks: {},\n  resetAll() { this.__mocks = {}; },\n  toJSON() { return this.__mocks; },\n};\n\nconst traps = {\n  get(target, prop) {\n    if (target.hasOwnProperty(prop)) return Reflect.get(target, prop);\n\n    return {\n      toReturn(o, op = 'find') {\n        target.__mocks.hasOwnProperty(prop)\n          ? target.__mocks[prop][op] = o\n          : target.__mocks[prop] = { [op]: o };\n\n        return this;\n      },\n\n      reset(op) {\n        op && delete target.__mocks[prop][op] || delete target.__mocks[prop];\n\n        return this;\n      },\n\n      toJSON() {\n        return target.__mocks[prop] || {};\n      },\n    };\n  },\n};\n\nconst mockingoose = new Proxy(target, traps);\n\nexport default mockingoose;\n"],"file":"index.js"}
>>>>>>> dda1e44dc67b34509a54285866868a0db03bfe5a
